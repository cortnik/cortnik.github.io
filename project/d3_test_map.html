<!DOCTYPE html>
<html lang="en">

<head>

    <title>Service Gap Analysis</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/landing-page.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">

	<!-- Data links -->
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="http://d3js.org/queue.v1.min.js"></script>
    <script src="hotspot_data/roads.geojson"></script>
    <script src="hotspot_data/metro.geojson"></script>
    
    <style>

     .hotspothover {
            fill: #ffe28a; 
        }

    .hotspot {
            opacity: .7;
        }

    .buffer {
        fill: "#5F9EA0"
        stroke: "#5F9EA0"
    }

    h2 {
        top: 300px;
    }

    .hidden {
        display: none;
    }
    div.tooltip {
        color: #f5f5f5;
        background-color: #5F9EA0;
        padding: .5em;
        border-radius: 2px;
        opacity: 0.9;
        position: absolute;

        </style>
    }
</head>
<body>

 <!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top topnav" role="navigation">
        <div class="container topnav">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand topnav" href="http://cortnik.github.io/project/">WOMEN + RIYADH METRO</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="http://cortnik.github.io/project/#background">BACKGROUND</a>
                    </li>
                    <li>
                        <a href="http://enialemik.github.io/riyadh/" target="blank">HOTSPOTS</a>
                    </li>
                    <li>
                        <a href="http://tsb123.github.io/d3/indexanimate.html" target="blank">PATHS</a>
                    </li>
                    <li>
                        <a href="#analysis">ANALYSIS</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>
    <div class="intro-header">
        <div class="container">
    <h1>Service Gap Analysis Coming Here</h1>
        </div>
    </div>
    <div class="container">

    <script>

    queue()
        .defer(d3.json, "hotspot_data/buffer_800.geojson")
        .defer(d3.json, "hotspot_data/all_hotspots_ever.geojson")
        .await(makeBuffers);

    // Width and Height of the whole visualization
    var width = 1000;
    var height = 1000;
    // Create SVG
    var svg = d3.select( "body" )
        .append( "svg" )
        .attr( "width", width )
        .attr( "height", height );
    // Append g element to the SVG
    // g will contain geometry elements
    var g = svg.append( "g" );

    var buffer1 = svg.append("g");

    var all_hotspots = svg.append("g");
    // Set Projection Parameters
    // Mercator
    var projection = d3.geo.mercator()
        .scale( 90000 )
        // .rotate( [71.057,0] )
        .center( [46.765, 24.713] )
        .translate( [width/2,height/2] );
    // Create GeoPath function that uses built-in D3 functionality to turn
    // lat/lon coordinates into screen coordinates
    var geoPath = d3.geo.path()
        .projection(projection);
    
    var tooltip = d3.select('body').append('div')
            .attr('class', 'hidden tooltip');

    var road_network = svg.append( "g" );
        road_network.selectAll( "path" )
        .data(roads.features )
        .enter()
        .append( "path" )
        .attr("fill", "none")
        .attr( "stroke", "#c9c9c9" )
        .attr("stroke-width", .5)
        .attr( "d", geoPath )
        .attr("class", "roads");

    var metroLines = svg.append( "g" );
        metroLines.selectAll( "path" )
        .data(metro.features )
        .enter()
        .append( "path" )
        .attr("fill", "none")
        .attr( "stroke", "#252525" )
        .attr("stroke-width", 1)
        .attr( "d", geoPath )
        .attr("class", "metro");

    
    function makeBuffers (error, buff800, hotspots) {
        if (error) throw error;

    console.log(buff800);
    console.log(hotspots);

        buffer1.selectAll("path")
        .data(buff800.features )
        .enter()
        .append("path")
        .attr("fill", "#5F9EA0")
        .attr( "stroke", "#5F9EA0" )
        .attr( "d", geoPath )
        .attr("transform", function (d) {return })
        .attr("class", "buffer")
        .on('mousemove', function(d) {
                    var mouse = d3.mouse(svg.node()).map(function(d) {
                        return parseInt(d);
                    });
                    tooltip.classed('hidden', false)
                        .attr('style', 'left:' + (mouse[0] +1) +
                                'px; top:' + (mouse[1] - 15) + 'px')
                        .html("Flow: " + d.properties.SUMflow);
                })
                .on('mouseout', function() {
                    tooltip.classed('hidden', true);
        });
    
    var color = d3.scale.threshold()
        .domain([1, 2, 6, 15, 36])
        .range(["#ffffd4", "#fee391", "#fec44f", "#fe9929", "#d95f0e", "#993404"]);

      all_hotspots.selectAll("circle")
        .data(hotspots.features )
        .enter()
        .append("circle")
        .style("fill", function(d) { return color([d.properties.flow]); })
        .attr("transform", function(d) {return "translate(" + projection([+d.properties.long,+d.properties.lat]) + ")";})
        .attr("r", 2)
        .attr("class", "hotspot");

    }

        
   </script>
   </div>
   <div>
   <H1> ANALYSIS SUMMED UP HERE</H1>
   </div>
   <div></div>
      <div></div>
</body>
</html>